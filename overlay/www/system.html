<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ç³»ç»Ÿæ•°æ®</title>
  <!-- å¼•å…¥åˆ†ç¦»çš„ CSS -->
  <link rel="stylesheet" href="/assets/ui.css">
  <link rel="stylesheet" href="/assets/system.css">
</head>
<body class="ui">
  <a href="/index.html" class="btn btn--ghost ui-home-btn" aria-label="è¿”å›ä¸»é¡µ"><svg class="ui-icon" aria-hidden="true"><use href="/assets/icons.svg#icon-home"/></svg><span>è¿”å›ä¸»é¡µ</span></a>
  <div class="container ui-animate-in">
    <h1><svg class="ui-icon" aria-hidden="true"><use href="/assets/icons.svg#icon-system"/></svg><span>ç³»ç»Ÿå®æ—¶æ•°æ®</span></h1>

    <div id="content">
      <div class="loading">æ­£åœ¨åŠ è½½ç³»ç»Ÿæ•°æ®...</div>
    </div>

    <div id="last-update" class="last-update"></div>

  </div>

  <!-- ğŸ”’ ç™»å½•çŠ¶æ€æ£€æµ‹ï¼ˆæ–°å¢ï¼‰ -->
  <script>
    (async () => {
      try {
        const res = await fetch('/home/check-auth');
        if (res.status === 401) {
          window.location.replace('/login.html');
          return;
        }
        // å·²è®¤è¯ï¼šç»§ç»­æ‰§è¡Œåç»­è„šæœ¬
      } catch (err) {
        window.location.replace('/login.html');
        return;
      }
    })();
  </script>

  <!-- åŸæœ‰æ•°æ®åŠ è½½é€»è¾‘ï¼ˆä¿æŒä¸å˜ï¼‰ -->
  <script>
    function fetchData() {
      const content = document.getElementById('content');
      const lastUpdate = document.getElementById('last-update');

      fetch('/home/system')
        .then(res => {
          if (!res.ok) throw new Error('HTTP ' + res.status);
          return res.json();
        })
        .then(data => {
          let html = '';

          if (data.load_percent !== undefined) {
            html += `<div class="row"><span class="label">CPU è´Ÿè½½</span><span class="value">${data.load_percent.toFixed(1)}%</span></div>`;
          }
          if (data.uptime_minutes !== undefined) {
            html += `<div class="row"><span class="label">è¿è¡Œæ—¶é—´</span><span class="value">${data.uptime_minutes} åˆ†é’Ÿ</span></div>`;
          }
          if (data.memory_percent !== undefined) {
            html += `<div class="row"><span class="label">å†…å­˜ä½¿ç”¨</span><span class="value">${data.memory_used_mb} MB / ${data.memory_total_mb} MB (${data.memory_percent}%)</span></div>`;
          }
          if (data.ip) {
            html += `<div class="row"><span class="label">IP åœ°å€</span><span class="value">${data.ip}</span></div>`;
          }
          if (data.cpu_temp_c !== undefined) {
            html += `<div class="row"><span class="label">CPU æ¸©åº¦</span><span class="value">${data.cpu_temp_c}Â°C</span></div>`;
          }
          if (data.disk_percent !== undefined) {
            html += `<div class="row"><span class="label">ç£ç›˜ä½¿ç”¨</span><span class="value">${data.disk_used_gb} GB / ${data.disk_total_gb} GB (${data.disk_percent}%)</span></div>`;
          }

          content.innerHTML = html || '<div class="error">æš‚æ— æ•°æ®</div>';
          lastUpdate.textContent = 'æœ€åæ›´æ–°ï¼š' + new Date().toLocaleTimeString();
        })
        .catch(err => {
          console.error('è·å–æ•°æ®å¤±è´¥:', err);
          content.innerHTML = `<div class="error">âŒ åŠ è½½å¤±è´¥ï¼š${err.message}</div>`;
          lastUpdate.textContent = '';
        });
    }

    fetchData();
    setInterval(fetchData, 10000); // æ¯10ç§’åˆ·æ–°
  </script>
</body>
</html>
